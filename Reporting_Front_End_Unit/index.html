<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <title>"Reporting"</title>
    <script src="libraries/js/angular.min.js"></script>
    <script src="libraries/js/jquery-3.2.1.min.js"></script>
    <script src="libraries/js/angular-route.min.js"></script>
    <script src="libraries/oi.select/dist/select-tpls.min.js"></script>
    <script src="libraries/bower_components/ng-file-model/ng-file-model.min.js"></script>

    <link rel="stylesheet" href="libraries/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <script src="libraries/popper.min.js"></script>
    <script src="libraries/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script src="node_modules\chart.js\dist\Chart.js"></script>

    <!-- <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"> -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway"> 

    <link href="libraries/css/w3.css" rel=stylesheet /><link>
    <link href="libraries/oi.select/dist/select.css" rel=stylesheet /><link>
    
    <!--To ensure proper rendering and touch zooming-->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.8/angular-material.min.css">

    <link href="libraries/css/styles.css" rel=stylesheet /><link>
</head>

<body id="body">

    <div class="heading">
        <h1>Task Comparisons</h1>
        <p>This page consists of charts that compare tasks by their relevant metrics</p>  
    </div>

    <div id="chartList" class="chart-container" style="position:relative; height:40vh; width:40vw">
        <canvas id="CPU-Time" width="200" height="200"></canvas>
        <canvas id="CPU-Usage" width="200" height="200"></canvas>
        <canvas id="Elapsed-Time" width="200" height="200"></canvas>
        <canvas id="Energy-Generated" width="200" height="200"></canvas>
        <canvas id="Heat-Generated" width="200" height="200"></canvas>
        <canvas id="Memory-Usage" width="200" height="200"></canvas>
    </div>

</body>

<script>

    function random_rgba() {
        var o = Math.round, r = Math.random, s = 255;
        return 'rgba(' + o(r()*s) + ',' + o(r()*s) + ',' + o(r()*s); //+ ',' + r().toFixed(1) + ')';
    }

    var serverObject = {
        "result": [
            {
                "taskID":3,
                "dispatcher": "Kudzai",
                "result": [
                    {
                        "messurement": "CPU-Usage",
                        "values": [
                            {"Timestamp": "20:00:01", "value": "26"},
                            {"Timestamp": "20:00:02", "value": "32"},
                            {"Timestamp": "20:00:03", "value": "54"},
                            {"Timestamp": "20:00:04", "value": "67"}
                        ]
                    },
                    {
                        "messurement": "Memory-Usage",
                        "values": [
                            {"Timestamp": "20:00:01", "value": "536870912"},
                            {"Timestamp": "20:00:02", "value": "502273915"},
                            {"Timestamp": "20:00:03", "value": "405678617"},
                            {"Timestamp": "20:00:04", "value": "498429513"}
                        ]
                    }
                ]
            },
            {
                "taskID":4,
                "dispatcher": "Kudzai",
                "result": [
                    {
                        "messurement": "CPU-Usage",
                        "values": [
                            {"Timestamp": "17:00:01", "value": "45"},
                            {"Timestamp": "17:00:02", "value": "42"},
                            {"Timestamp": "17:00:03", "value": "56"},
                            {"Timestamp": "17:00:04", "value": "54"}
                        ]
                    },
                    {
                        "messurement": "Memory-Usage",
                        "values": [
                            {"Timestamp": "20:00:01", "value": "506870912"},
                            {"Timestamp": "20:00:02", "value": "532273915"},
                            {"Timestamp": "20:00:03", "value": "495678617"},
                            {"Timestamp": "20:00:04", "value": "408429513"}
                        ]
                    }
                ]
            },
            {
                "taskID":5,
                "dispatcher": "Kudzai",
                "result": [
                    {
                        "messurement": "CPU-Usage",
                        "values": [
                            {"Timestamp": "17:00:01", "value": "65"},
                            {"Timestamp": "17:00:02", "value": "56"},
                            {"Timestamp": "17:00:03", "value": "41"},
                            {"Timestamp": "17:00:04", "value": "73"}
                        ]
                    }
                ]
            }
        ]
    };

    var valueList = [];
    var timeList = [];
    for(var z = 0; z < serverObject.result.length; ++z){
       
        for(var r = 0; r < serverObject.result[z].result.length; ++r){

            var timeListTemp = [];
            var valueListTemp = []; 
            for(var t = 0; t < serverObject.result[z].result[r].values.length; ++t){

                timeListTemp.push(serverObject.result[z].result[r].values[t].Timestamp);
                valueListTemp.push(serverObject.result[z].result[r].values[t].value);
            }
            valueList.push(valueListTemp);
            timeList.push(timeListTemp);
        }
    }

    console.log(timeList);
    console.log(valueList);

    var chartListDiv = document.getElementById("chartList");    
    var index2 = 0;
    var charts = [];// ["CPU-Time", "CPU-Usage", "Elapsed-Time", "Energy-Generated", "Heat-Generated", "Memory-Usage"];
    for(var f = 0; f < serverObject.result.length; ++f){

        for(var d = 0; d < serverObject.result[f].result.length; ++d){
            // console.log("loop");
            // var chartDiv = document.createElement('div');
            // chartDiv.innerHTML = '<canvas id="myChart'+f+d+'" width="200" height="200"></canvas>';
            // chartListDiv.appendChild(chartDiv);

            console.log(index2);
            var colour = random_rgba() + ',' + 0.2 + ')';
            
            var ctx = document.getElementById(serverObject.result[f].result[d].messurement).getContext('2d');
            
            var index;
            if(serverObject.result[f].result[d].messurement == "CPU-Time"){
                index = 0;
            }else if(serverObject.result[f].result[d].messurement == "CPU-Usage"){
                index = 1;
            }else if(serverObject.result[f].result[d].messurement == "Elapsed-Time"){
                index = 2;
            }else if(serverObject.result[f].result[d].messurement == "Energy-Generated"){
                index = 3;
            } else if(serverObject.result[f].result[d].messurement == "Heat-Generated"){
                index = 4;
            } else if(serverObject.result[f].result[d].messurement == "Memory-Usage"){
                index = 5;
            }

            if(charts[index] == null){
                charts[index] = new Chart(ctx, {
                    type: 'line',
                    data: {
                        
                        labels: timeList[index2],
                        datasets: [{
                            label: 'TASK ' + serverObject.result[f].taskID + " " + serverObject.result[f].result[d].messurement,
                            data: valueList[index2],
                            backgroundColor: [
                                colour
                            ],
                            borderColor: [
                                colour
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero:true
                                }
                            }]
                        }
                    }
                });
                index2++;
            }
            else{

                charts[index].data.datasets.push({
                    label: 'TASK ' + serverObject.result[f].taskID + " " + serverObject.result[f].result[d].messurement,
                    data: valueList[index2],
                    backgroundColor: [
                        colour
                    ],
                    borderColor: [
                        colour
                    ],
                    borderWidth: 1
                });
                charts[index].update();
                index2++;
            }
        }
    }
    </script>
    


</html>